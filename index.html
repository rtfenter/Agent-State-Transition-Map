<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Agent State Transition Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="page-header">
    <div class="page-header-inner">
      <h1>Agent State Transition Map</h1>
      <p class="tagline">
        Visualize how an agent moves through tasks, states, errors, and fallback paths as conditions change.
      </p>
    </div>
  </header>

  <main class="main">
    <!-- Left: Inputs -->
    <section class="panel panel-input">
      <div class="panel-header">
        <h2>Task, Conditions & Rules</h2>
      </div>

      <p class="help-text">
        Define the agent’s task, environment conditions, and rules. Then toggle failure modes to see how the state path changes.
      </p>

      <div class="field">
        <label for="task-input">Task</label>
        <textarea
          id="task-input"
          class="text-input"
          rows="3"
          spellcheck="false"
          placeholder="Example: Draft a summary email about this incident and notify the on-call engineer."
        ></textarea>
      </div>

      <div class="field">
        <label for="conditions-input">Conditions / Context</label>
        <textarea
          id="conditions-input"
          class="text-input"
          rows="3"
          spellcheck="false"
          placeholder="Example: Logs are delayed by 2 minutes; ticket system is available; user provided partial details."
        ></textarea>
      </div>

      <div class="field">
        <label for="rules-input">Key Rules / Policies</label>
        <textarea
          id="rules-input"
          class="text-input"
          rows="3"
          spellcheck="false"
          placeholder="Example: Never close an incident without a ticket; escalate to human if data is missing or inconsistent."
        ></textarea>
      </div>

      <div class="variation-settings">
        <div class="variation-settings-header">
          <h3>Failure & Drift Toggles</h3>
          <p class="help-text">
            Turn on different failure modes to see how the agent moves into error, timeout, or fallback states.
          </p>
        </div>

        <div class="toggle-grid">
          <label class="toggle-row">
            <input type="checkbox" id="toggle-missing" />
            <span class="toggle-label-main">Missing or partial data</span>
            <span class="toggle-label-sub">
              Inputs are incomplete or inconsistent — the agent can’t safely proceed.
            </span>
          </label>

          <label class="toggle-row">
            <input type="checkbox" id="toggle-conflict" />
            <span class="toggle-label-main">Conflicting rules</span>
            <span class="toggle-label-sub">
              Policies or instructions disagree — multiple transitions claim the same condition.
            </span>
          </label>

          <label class="toggle-row">
            <input type="checkbox" id="toggle-timeout" />
            <span class="toggle-label-main">Timeouts / slow dependencies</span>
            <span class="toggle-label-sub">
              External services or tools don’t respond in time.
            </span>
          </label>

          <label class="toggle-row">
            <input type="checkbox" id="toggle-invalid" />
            <span class="toggle-label-main">Invalid / impossible state</span>
            <span class="toggle-label-sub">
              The agent lands in a state that should never be reachable (bug, design gap, or drift).
            </span>
          </label>
        </div>
      </div>

      <div class="panel-footer">
        <button id="run-trace" class="btn btn-primary">
          Run State Trace
        </button>
        <span id="status" class="parse-status" aria-live="polite"></span>
      </div>
    </section>

    <!-- Right: Map & Trace -->
    <section class="panel panel-map">
      <div class="panel-header">
        <h2>State Map & Trace</h2>
      </div>

      <div id="summary" class="summary">
        <div class="summary-badge summary-badge-idle">
          No trace yet. Define a task, toggle conditions, then click <strong>Run State Trace</strong>.
        </div>
      </div>

      <div class="state-map-wrapper">
        <div class="state-map-header">
          <span class="map-title">State Transition Skeleton</span>
          <span class="map-hint">
            States are fixed; the highlighted path shows how this specific scenario flows.
          </span>
        </div>

        <div class="state-map-grid">
          <div class="state-node state-node-initial" id="state-initial">
            <div class="state-node-label">Initial State</div>
            <div class="state-node-body">
              Task received, context assembled, rules loaded.
            </div>
          </div>

          <div class="state-node state-node-processing" id="state-processing">
            <div class="state-node-label">Next / Processing State</div>
            <div class="state-node-body">
              Agent is executing the task under current conditions and rules.
            </div>
          </div>

          <div class="state-node state-node-timeout" id="state-timeout">
            <div class="state-node-label">Timeout State</div>
            <div class="state-node-body">
              Dependencies are too slow or unresponsive; work is blocked.
            </div>
          </div>

          <div class="state-node state-node-error" id="state-error">
            <div class="state-node-label">Error State</div>
            <div class="state-node-body">
              Agent detects a hard failure: missing inputs, conflicts, or invalid path.
            </div>
          </div>

          <div class="state-node state-node-fallback" id="state-fallback">
            <div class="state-node-label">Fallback Handler</div>
            <div class="state-node-body">
              Recovery logic: retries, degraded mode, escalation, or human handoff.
            </div>
          </div>

          <div class="state-node state-node-recovery" id="state-recovery">
            <div class="state-node-label">Recovery / Retry</div>
            <div class="state-node-body">
              Agent attempts to continue with adjusted inputs, reduced scope, or new strategy.
            </div>
          </div>

          <div class="state-node state-node-end-ok" id="state-end-ok">
            <div class="state-node-label">End State — Normal Completion</div>
            <div class="state-node-body">
              Task finished as intended; no major drift or failure.
            </div>
          </div>

          <div class="state-node state-node-end-degraded" id="state-end-degraded">
            <div class="state-node-label">End State — Degraded Success</div>
            <div class="state-node-body">
              Task finished with caveats (fallback, partial output, or manual intervention).
            </div>
          </div>

          <div class="state-node state-node-end-failed" id="state-end-failed">
            <div class="state-node-label">End State — Failed / Stalled</div>
            <div class="state-node-body">
              Agent could not safely complete the task; requires redesign or debugging.
            </div>
          </div>
        </div>

        <div class="state-map-legend">
          <span class="legend-pill legend-pill-active"></span>
          <span class="legend-text">Bright highlight = final state for this scenario.</span>
          <span class="legend-pill legend-pill-visited"></span>
          <span class="legend-text">Soft outline = states visited along the way.</span>
        </div>
      </div>

      <div class="trace-section">
        <h3>State Trace</h3>
        <p class="help-text">
          This log translates the path into plain language — useful for debugging and interviews.
        </p>
        <ol id="trace-list" class="trace-list">
          <li class="trace-placeholder">
            No trace yet. When you run a scenario, each state transition will appear here in order.
          </li>
        </ol>
      </div>

      <div class="comparison-notes">
        <h3>Interpretation Notes</h3>
        <p id="notes-text" class="comparison-text">
          Once you run a scenario, this section will summarize how the selected conditions shaped the agent’s path — e.g., “Timeouts forced a fallback branch, but the agent still reached a degraded end state.”
        </p>
      </div>
    </section>
  </main>

  <footer class="page-footer">
    <p>
      Part of the
      <a href="https://github.com/rtfenter/Applied-Intelligence-Systems-Series" target="_blank" rel="noreferrer">
        Applied Intelligence Systems Series
      </a>.
    </p>
  </footer>

  <script src="app.js"></script>
</body>
</html>
